"use strict";(self["webpackChunkprojekt"]=self["webpackChunkprojekt"]||[]).push([[526],{655:function(e,t,r){var o=r(6955),n=String;e.exports=function(e){if("Symbol"===o(e))throw new TypeError("Cannot convert a Symbol value to a string");return n(e)}},2526:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});r(4114),r(8111),r(2489),r(1701),r(8237),r(7642),r(8004),r(3853),r(5876),r(2475),r(5024),r(1698),r(4979);var o=r(6768),n=r(4232),s=r(1387);const a={class:"scroll-container"},i=["src","onClick"],c={class:"card-content"},l={name:"CardView",data(){return{selectedDate:"",filteredTrees:[],trees:[]}},computed:{uniqueSpecies(){return[...new Set(this.trees.map((e=>e.tree_type)))]},uniqueLocations(){return[...new Set(this.trees.map((e=>e.locationName||e.latitude+", "+e.longitude)))]},averageHeight(){if(!this.filteredTrees.length)return 0;const e=this.filteredTrees.reduce(((e,t)=>e+Number(t.height)),0);return(e/this.filteredTrees.length).toFixed(2)}},methods:{async fetchTrees(){try{const e=localStorage.getItem("token"),t="https://treescope.cs.hs-fulda.de/api/v1/trees/user-tree",r=await fetch(t,{method:"GET",headers:{accept:"application/json",...e&&{Authorization:`Bearer ${e}`}}});if(!r.ok)return void console.error("Fehler beim Laden der Baumdaten");const o=await r.json();console.log("Serverantwort:",o);let n=o.trees||[];const s=this.getCurrentUserId(e);this.trees=n.filter((e=>e.initial_creator_id===s&&e.latitude&&e.longitude&&!isNaN(parseFloat(e.latitude))&&!isNaN(parseFloat(e.longitude)))),await Promise.all(this.trees.map((async e=>{const t=e.measurements&&e.measurements.length>0?e.measurements[0]:null;e.height=t?t.height:"",e.locationName=await this.reverseGeocode(parseFloat(e.latitude),parseFloat(e.longitude)),e.imageUrl=this.getImageUrl(e)}))),this.updateFilteredTrees()}catch(e){console.error("Netzwerkfehler:",e)}},updateFilteredTrees(){this.filteredTrees=this.trees.filter((e=>{const t=e.created_at?e.created_at.substring(0,10):"";return!this.selectedDate||t===this.selectedDate}))},getCurrentUserId(e){if(!e)return null;try{const t=JSON.parse(atob(e.split(".")[1]));return t.id}catch(t){return console.error("Fehler beim Auslesen der Benutzer-ID aus dem Token:",t),null}},async reverseGeocode(e,t){try{if(!e||!t||isNaN(e)||isNaN(t))return"";const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e}&lon=${t}`),o=await r.json();return o.address&&(o.address.city||o.address.town||o.address.village)||""}catch(r){return console.error("Reverse-Geocoding-Fehler:",r),""}},getImageUrl(e){const t="https://treescope.cs.hs-fulda.de/static/uploads";if(e.files&&e.files.length>0&&e.files[0].photo_path){const r=`preferredImage-${e.id}`;let o=localStorage.getItem(r);o=o?parseInt(o,10):0,o>=e.files.length&&(o=0);let n=e.files[o].photo_path.trim();return n.startsWith("/uploads/")?n=n.replace(/^\/uploads\//,""):n.startsWith("/static/uploads/")&&(n=n.replace(/^\/static\/uploads\//,"")),`${t}/${n}`}return null},toggleImage(e){if(e.files&&e.files.length>1){const t=`preferredImage-${e.id}`;let r=localStorage.getItem(t);r=r?parseInt(r,10):0,r=(r+1)%e.files.length,localStorage.setItem(t,r),e.imageUrl=this.getImageUrl(e)}},formatDate(e){if(!e)return"";const t=new Date(e),r=String(t.getDate()).padStart(2,"0"),o=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${r}.${o}.${n}`}},created(){this.fetchTrees()}};var u=Object.assign(l,{setup(e){const t=(0,s.rd)(),r=()=>{const e=localStorage.getItem("token");e||t.push("/")};return(0,o.sV)((()=>{r()})),(e,t)=>((0,o.uX)(),(0,o.CE)("div",a,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filteredTrees,(r=>((0,o.uX)(),(0,o.CE)("div",{class:"card",key:r.id},[(0,o.Lk)("img",{src:r.imageUrl,alt:"Bild von {{ tree.tree_type.name }}",class:"card-image",onClick:t=>e.toggleImage(r)},null,8,i),(0,o.Lk)("div",c,[(0,o.Lk)("h2",null,(0,n.v_)(`${r.tree_type.name} (${r.tree_type.scientific_name})`),1),(0,o.Lk)("p",null,[t[0]||(t[0]=(0,o.Lk)("strong",null,"Standort:",-1)),(0,o.eW)(" "+(0,n.v_)(r.locationName?r.locationName:"Keine Angaben"),1)]),(0,o.Lk)("p",null,[t[1]||(t[1]=(0,o.Lk)("strong",null,"Höhe:",-1)),(0,o.eW)(" "+(0,n.v_)(r.height)+" m",1)]),(0,o.Lk)("p",null,[t[2]||(t[2]=(0,o.Lk)("strong",null,"Datum:",-1)),(0,o.eW)(" "+(0,n.v_)(e.formatDate(r.created_at)),1)]),(0,o.Lk)("p",null,[t[3]||(t[3]=(0,o.Lk)("strong",null,"CO₂ Gespeichert:",-1)),(0,o.eW)(" "+(0,n.v_)(r.co2_stored.toFixed(2))+" kg",1)])])])))),128))]))}}),d=r(1241);const p=(0,d.A)(u,[["__scopeId","data-v-28cd7b0e"]]);var E=p},2603:function(e,t,r){var o=r(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:o(e)}},2967:function(e,t,r){var o=r(6706),n=r(34),s=r(7750),a=r(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=o(Object.prototype,"__proto__","set"),e(r,[]),t=r instanceof Array}catch(i){}return function(r,o){return s(r),a(o),n(r)?(t?e(r,o):r.__proto__=o,r):r}}():void 0)},3167:function(e,t,r){var o=r(4901),n=r(34),s=r(2967);e.exports=function(e,t,r){var a,i;return s&&o(a=t.constructor)&&a!==r&&n(i=a.prototype)&&i!==r.prototype&&s(e,i),e}},3506:function(e,t,r){var o=r(3925),n=String,s=TypeError;e.exports=function(e){if(o(e))return e;throw new s("Can't set "+n(e)+" as a prototype")}},3925:function(e,t,r){var o=r(34);e.exports=function(e){return o(e)||null===e}},4979:function(e,t,r){var o=r(6518),n=r(4576),s=r(7751),a=r(6980),i=r(4913).f,c=r(9297),l=r(679),u=r(3167),d=r(2603),p=r(5002),E=r(8574),m=r(3724),h=r(6395),_="DOMException",g=s("Error"),f=s(_),R=function(){l(this,I);var e=arguments.length,t=d(e<1?void 0:arguments[0]),r=d(e<2?void 0:arguments[1],"Error"),o=new f(t,r),n=new g(t);return n.name=_,i(o,"stack",a(1,E(n.stack,1))),u(o,this,R),o},I=R.prototype=f.prototype,v="stack"in new g(_),T="stack"in new f(1,2),N=f&&m&&Object.getOwnPropertyDescriptor(n,_),S=!!N&&!(N.writable&&N.configurable),A=v&&!S&&!T;o({global:!0,constructor:!0,forced:h||A},{DOMException:A?R:f});var D=s(_),k=D.prototype;if(k.constructor!==D)for(var y in h||i(k,"constructor",a(1,D)),p)if(c(p,y)){var O=p[y],w=O.s;c(D,w)||i(D,w,a(6,O.c))}},5002:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8574:function(e,t,r){var o=r(9504),n=Error,s=o("".replace),a=function(e){return String(new n(e).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,c=i.test(a);e.exports=function(e,t){if(c&&"string"==typeof e&&!n.prepareStackTrace)while(t--)e=s(e,i,"");return e}}}]);
//# sourceMappingURL=526.4881e10a.js.map