"use strict";(self["webpackChunkprojekt"]=self["webpackChunkprojekt"]||[]).push([[963],{655:function(e,t,r){var o=r(6955),n=String;e.exports=function(e){if("Symbol"===o(e))throw new TypeError("Cannot convert a Symbol value to a string");return n(e)}},1344:function(e,t,r){r.r(t),r.d(t,{default:function(){return h}});r(4114),r(8111),r(2489),r(1701),r(8237),r(7642),r(8004),r(3853),r(5876),r(2475),r(5024),r(1698),r(4979);var o=r(6768),n=r(4232),a=r(1387);const s={class:"scroll-container"},i=["src","onClick"],c={class:"card-content"},l=["onClick"],u=["onClick"],d={name:"CardView",data(){return{selectedDate:"",filteredTrees:[],trees:[]}},computed:{uniqueSpecies(){return[...new Set(this.trees.map((e=>e.tree_type)))]},uniqueLocations(){return[...new Set(this.trees.map((e=>e.locationName||e.latitude+", "+e.longitude)))]},averageHeight(){if(!this.filteredTrees.length)return 0;const e=this.filteredTrees.reduce(((e,t)=>e+Number(t.height)),0);return(e/this.filteredTrees.length).toFixed(2)}},methods:{async fetchTrees(){try{const e=localStorage.getItem("token"),t="https://treescope.cs.hs-fulda.de/api/v1/trees/user-tree",r=await fetch(t,{method:"GET",headers:{accept:"application/json",...e&&{Authorization:`Bearer ${e}`}}});if(!r.ok)return void console.error("Fehler beim Laden der Baumdaten");const o=await r.json();console.log("Serverantwort:",o);let n=o.trees||[];const a=this.getCurrentUserId(e);this.trees=n.filter((e=>e.initial_creator_id===a&&e.latitude&&e.longitude&&!isNaN(parseFloat(e.latitude))&&!isNaN(parseFloat(e.longitude)))),await Promise.all(this.trees.map((async e=>{const t=e.measurements&&e.measurements.length>0?e.measurements[0]:null;e.height=t?t.height:"",e.locationName=await this.reverseGeocode(parseFloat(e.latitude),parseFloat(e.longitude)),e.imageUrl=this.getImageUrl(e)}))),this.updateFilteredTrees()}catch(e){console.error("Netzwerkfehler:",e)}},updateFilteredTrees(){this.filteredTrees=this.trees.filter((e=>{const t=e.created_at?e.created_at.substring(0,10):"";return!this.selectedDate||t===this.selectedDate}))},getCurrentUserId(e){if(!e)return null;try{const t=JSON.parse(atob(e.split(".")[1]));return t.id}catch(t){return console.error("Fehler beim Auslesen der Benutzer-ID aus dem Token:",t),null}},async reverseGeocode(e,t){try{if(!e||!t||isNaN(e)||isNaN(t))return"";const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e}&lon=${t}`,{headers:{"User-Agent":"BaumMessung/1.0 (test@domain.com)"}}),o=await r.json();return o.address&&(o.address.city||o.address.town||o.address.village||o.address.county||o.address.state)||""}catch(r){return console.error("Reverse-Geocoding-Fehler:",r),""}},getImageUrl(e){const t="https://treescope.cs.hs-fulda.de/static/uploads";if(e.files&&e.files.length>0&&e.files[0].photo_path){const r=`preferredImage-${e.id}`;let o=localStorage.getItem(r);o=o?parseInt(o,10):0,o>=e.files.length&&(o=0);let n=e.files[o].photo_path.trim();return n.startsWith("/uploads/")?n=n.replace(/^\/uploads\//,""):n.startsWith("/static/uploads/")&&(n=n.replace(/^\/static\/uploads\//,"")),`${t}/${n}`}return null},toggleImage(e){if(e.files&&e.files.length>1){const t=`preferredImage-${e.id}`;let r=localStorage.getItem(t);r=r?parseInt(r,10):0,r=(r+1)%e.files.length,localStorage.setItem(t,r),e.imageUrl=this.getImageUrl(e)}},formatDate(e){if(!e)return"";const t=new Date(e),r=String(t.getDate()).padStart(2,"0"),o=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${r}.${o}.${n}`},shareOnTwitter(e){const t=encodeURIComponent("Schau dir diesen coolen Baum an!");window.open(`https://twitter.com/intent/tweet?text=${t}&url=${e}`,"_blank")},shareToInstagram(e){const t=/Android/i.test(navigator.userAgent);if(!t)return void alert("Diese Funktion funktioniert nur auf Android-Geräten mit installierter Instagram-App.");const r=encodeURIComponent(e),o=`intent://story?source_url=${r}#Intent;package=com.instagram.android;scheme=instagram;end`;window.location.href=o}},created(){this.fetchTrees()}};var p=Object.assign(d,{setup(e){const t=(0,a.rd)(),r=()=>{const e=localStorage.getItem("token");e||t.push("/")};return(0,o.sV)((()=>{r()})),(e,t)=>((0,o.uX)(),(0,o.CE)("div",s,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filteredTrees,(r=>((0,o.uX)(),(0,o.CE)("div",{class:"card",key:r.id},[(0,o.Lk)("img",{src:r.imageUrl,alt:"Bild von {{ tree.tree_type.name }}",class:"card-image",onClick:t=>e.toggleImage(r)},null,8,i),(0,o.Lk)("div",c,[(0,o.Lk)("h2",null,(0,n.v_)(`${r.tree_type.name} (${r.tree_type.scientific_name})`),1),(0,o.Lk)("p",null,[t[0]||(t[0]=(0,o.Lk)("strong",null,"Standort:",-1)),(0,o.eW)(" "+(0,n.v_)(r.locationName?r.locationName:"Keine Angaben"),1)]),(0,o.Lk)("p",null,[t[1]||(t[1]=(0,o.Lk)("strong",null,"Höhe:",-1)),(0,o.eW)(" "+(0,n.v_)(r.height)+" m",1)]),(0,o.Lk)("p",null,[t[2]||(t[2]=(0,o.Lk)("strong",null,"Datum:",-1)),(0,o.eW)(" "+(0,n.v_)(e.formatDate(r.created_at)),1)]),(0,o.Lk)("p",null,[t[3]||(t[3]=(0,o.Lk)("strong",null,"CO₂ Gespeichert:",-1)),(0,o.eW)(" "+(0,n.v_)(r.co2_stored.toFixed(2))+" kg",1)]),(0,o.Lk)("p",null,[(0,o.Lk)("button",{class:"social-button",onClick:t=>e.shareOnTwitter(r.imageUrl)},t[4]||(t[4]=[(0,o.Lk)("img",{src:"https://upload.wikimedia.org/wikipedia/commons/6/6f/Logo_of_Twitter.svg",alt:"Twitter"},null,-1)]),8,l),t[6]||(t[6]=(0,o.eW)("   ")),(0,o.Lk)("button",{class:"social-button",onClick:t=>e.shareToInstagram(r.imageUrl)},t[5]||(t[5]=[(0,o.Lk)("img",{src:"https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png",alt:"Twitter"},null,-1)]),8,u)])])])))),128))]))}}),m=r(1241);const g=(0,m.A)(p,[["__scopeId","data-v-a367374e"]]);var h=g},2603:function(e,t,r){var o=r(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:o(e)}},2967:function(e,t,r){var o=r(6706),n=r(34),a=r(7750),s=r(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=o(Object.prototype,"__proto__","set"),e(r,[]),t=r instanceof Array}catch(i){}return function(r,o){return a(r),s(o),n(r)?(t?e(r,o):r.__proto__=o,r):r}}():void 0)},3167:function(e,t,r){var o=r(4901),n=r(34),a=r(2967);e.exports=function(e,t,r){var s,i;return a&&o(s=t.constructor)&&s!==r&&n(i=s.prototype)&&i!==r.prototype&&a(e,i),e}},3506:function(e,t,r){var o=r(3925),n=String,a=TypeError;e.exports=function(e){if(o(e))return e;throw new a("Can't set "+n(e)+" as a prototype")}},3925:function(e,t,r){var o=r(34);e.exports=function(e){return o(e)||null===e}},4979:function(e,t,r){var o=r(6518),n=r(4576),a=r(7751),s=r(6980),i=r(4913).f,c=r(9297),l=r(679),u=r(3167),d=r(2603),p=r(5002),m=r(8574),g=r(3724),h=r(6395),E="DOMException",_=a("Error"),f=a(E),R=function(){l(this,I);var e=arguments.length,t=d(e<1?void 0:arguments[0]),r=d(e<2?void 0:arguments[1],"Error"),o=new f(t,r),n=new _(t);return n.name=E,i(o,"stack",s(1,m(n.stack,1))),u(o,this,R),o},I=R.prototype=f.prototype,T="stack"in new _(E),v="stack"in new f(1,2),k=f&&g&&Object.getOwnPropertyDescriptor(n,E),w=!!k&&!(k.writable&&k.configurable),N=T&&!w&&!v;o({global:!0,constructor:!0,forced:h||N},{DOMException:N?R:f});var A=a(E),S=A.prototype;if(S.constructor!==A)for(var D in h||i(S,"constructor",s(1,A)),p)if(c(p,D)){var y=p[D],C=y.s;c(A,C)||i(A,C,s(6,y.c))}},5002:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8574:function(e,t,r){var o=r(9504),n=Error,a=o("".replace),s=function(e){return String(new n(e).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,c=i.test(s);e.exports=function(e,t){if(c&&"string"==typeof e&&!n.prepareStackTrace)while(t--)e=a(e,i,"");return e}}}]);
//# sourceMappingURL=963.2776d3eb.js.map