"use strict";(self["webpackChunkprojekt"]=self["webpackChunkprojekt"]||[]).push([[218],{655:function(e,t,r){var o=r(6955),n=String;e.exports=function(e){if("Symbol"===o(e))throw new TypeError("Cannot convert a Symbol value to a string");return n(e)}},2603:function(e,t,r){var o=r(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:o(e)}},2967:function(e,t,r){var o=r(6706),n=r(34),s=r(7750),l=r(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{e=o(Object.prototype,"__proto__","set"),e(r,[]),t=r instanceof Array}catch(i){}return function(r,o){return s(r),l(o),n(r)?(t?e(r,o):r.__proto__=o,r):r}}():void 0)},3167:function(e,t,r){var o=r(4901),n=r(34),s=r(2967);e.exports=function(e,t,r){var l,i;return s&&o(l=t.constructor)&&l!==r&&n(i=l.prototype)&&i!==r.prototype&&s(e,i),e}},3506:function(e,t,r){var o=r(3925),n=String,s=TypeError;e.exports=function(e){if(o(e))return e;throw new s("Can't set "+n(e)+" as a prototype")}},3925:function(e,t,r){var o=r(34);e.exports=function(e){return o(e)||null===e}},4979:function(e,t,r){var o=r(6518),n=r(4576),s=r(7751),l=r(6980),i=r(4913).f,a=r(9297),c=r(679),d=r(3167),u=r(2603),p=r(5002),h=r(8574),m=r(3724),E=r(6395),g="DOMException",f=s("Error"),w=s(g),k=function(){c(this,_);var e=arguments.length,t=u(e<1?void 0:arguments[0]),r=u(e<2?void 0:arguments[1],"Error"),o=new w(t,r),n=new f(t);return n.name=g,i(o,"stack",l(1,h(n.stack,1))),d(o,this,k),o},_=k.prototype=w.prototype,L="stack"in new f(g),S="stack"in new w(1,2),v=w&&m&&Object.getOwnPropertyDescriptor(n,g),R=!!v&&!(v.writable&&v.configurable),T=L&&!R&&!S;o({global:!0,constructor:!0,forced:E||T},{DOMException:T?k:w});var A=s(g),D=A.prototype;if(D.constructor!==A)for(var I in E||i(D,"constructor",l(1,A)),p)if(a(p,I)){var y=p[I],N=y.s;a(A,N)||i(A,N,l(6,y.c))}},5002:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8574:function(e,t,r){var o=r(9504),n=Error,s=o("".replace),l=function(e){return String(new n(e).stack)}("zxcasd"),i=/\n\s*at [^:]*:[^\n]*/,a=i.test(l);e.exports=function(e,t){if(a&&"string"==typeof e&&!n.prepareStackTrace)while(t--)e=s(e,i,"");return e}},8641:function(e,t,r){r.r(t),r.d(t,{default:function(){return L}});r(4114),r(8111),r(2489),r(1701),r(8237),r(7642),r(8004),r(3853),r(5876),r(2475),r(5024),r(1698),r(4979);var o=r(6768),n=r(4232),s=r(5130),l=r.p+"img/calendar.f607a9fa.svg",i=r(1387);const a={class:"table-wrapper"},c={class:"table-ui"},d=["src"],u={class:"dropdown-menu small-dropdown"},p={class:"checkbox-list"},h=["value"],m={class:"dropdown-menu small-dropdown"},E={class:"checkbox-list"},g=["value"],f={name:"TableView",data(){return{selectedDate:"",selectedSpecies:[],selectedLocations:[],selectAllSpecies:!1,selectAllLocations:!1,speciesSearch:"",locationSearch:"",dropdownOpen:null,calendarOpen:!1,dropdownPosition:{},filteredTrees:[],trees:[]}},computed:{filteredSpecies(){return this.uniqueSpecies.filter((e=>e.toLowerCase().includes(this.speciesSearch.toLowerCase())))},filteredLocations(){return this.uniqueLocations.filter((e=>e.toLowerCase().includes(this.locationSearch.toLowerCase())))},uniqueSpecies(){return[...new Set(this.trees.map((e=>e.tree_type.name)))]},uniqueLocations(){return[...new Set(this.trees.map((e=>e.locationName||e.latitude+", "+e.longitude)))]},averageHeight(){if(!this.filteredTrees.length)return 0;const e=this.filteredTrees.reduce(((e,t)=>e+Number(t.height)),0);return(e/this.filteredTrees.length).toFixed(2)}},methods:{openNativeDatePicker(){0!==this.filteredTrees.length&&this.$nextTick((()=>{this.$refs.dateInput.showPicker?this.$refs.dateInput.showPicker():this.$refs.dateInput.focus()}))},toggleDropdown(e,t){0!==this.filteredTrees.length&&(this.dropdownOpen=this.dropdownOpen===e?null:e,this.calendarOpen=!1,this.setDropdownPosition(t))},toggleSelectAllSpecies(){this.selectedSpecies=this.selectAllSpecies?[...this.uniqueSpecies]:[],this.updateFilteredTrees()},toggleSelectAllLocations(){this.selectedLocations=this.selectAllLocations?[...this.uniqueLocations]:[],this.updateFilteredTrees()},updateFilteredTrees(){this.filteredTrees=this.trees.filter((e=>{const t=e.created_at?e.created_at.substring(0,10):"",r=!this.selectedDate||t===this.selectedDate,o=!this.selectedSpecies.length||this.selectedSpecies.includes(e.tree_type.name),n=e.locationName||e.latitude+", "+e.longitude,s=!this.selectedLocations.length||this.selectedLocations.includes(n);return r&&o&&s}))},closeDropdowns(){this.dropdownOpen=null,this.calendarOpen=!1},setDropdownPosition(e){const t=e.target.closest("th"),r=t.getBoundingClientRect(),o=250;let n=r.bottom+window.scrollY-200,s=r.left+window.scrollX;n+o>window.innerHeight&&(n=r.top+window.scrollY-o),s+250>window.innerWidth&&(s=r.left+window.scrollX-250),this.dropdownPosition={top:`${n}px`,left:`${s}px`}},async fetchTrees(){try{const e=localStorage.getItem("token"),t="https://treescope.cs.hs-fulda.de/api/v1/trees/user-tree",r=await fetch(t,{method:"GET",headers:{accept:"application/json",...e&&{Authorization:`Bearer ${e}`}}});if(!r.ok)return void console.error("Fehler beim Laden der Baumdaten");const o=await r.json();console.log("Serverantwort:",o);let n=o.trees||[];const s=this.getCurrentUserId(e);this.trees=n.filter((e=>e.initial_creator_id===s&&e.latitude&&e.longitude&&!isNaN(parseFloat(e.latitude))&&!isNaN(parseFloat(e.longitude)))),await Promise.all(this.trees.map((async e=>{const t=e.measurements&&e.measurements.length>0?e.measurements[0]:null;e.height=t?t.height:"",e.locationName=await this.reverseGeocode(parseFloat(e.latitude),parseFloat(e.longitude)),e.imageUrl=this.getImageUrl(e)}))),this.updateFilteredTrees(),this.addMarkers()}catch(e){console.error("Netzwerkfehler:",e)}},getCurrentUserId(e){if(!e)return null;try{const t=JSON.parse(atob(e.split(".")[1]));return t.id}catch(t){return console.error("Fehler beim Auslesen der Benutzer-ID aus dem Token:",t),null}},async reverseGeocode(e,t){try{if(!e||!t||isNaN(e)||isNaN(t))return"";const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e}&lon=${t}`),o=await r.json();return o.address&&(o.address.city||o.address.town||o.address.village)||""}catch(r){return console.error("Reverse-Geocoding-Fehler:",r),""}},getImageUrl(e){const t="https://treescope.cs.hs-fulda.de/static/uploads";if(e.files&&e.files.length>0&&e.files[0].photo_path){let r=e.files[0].photo_path.trim();return r.startsWith("/uploads/")?r=r.replace(/^\/uploads\//,""):r.startsWith("/static/uploads/")&&(r=r.replace(/^\/static\/uploads\//,"")),`${t}/${r}`}return null},formatDate(e){if(!e)return"";const t=new Date(e),r=String(t.getDate()).padStart(2,"0"),o=String(t.getMonth()+1).padStart(2,"0"),n=t.getFullYear();return`${r}.${o}.${n}`},addMarkers(){},getLocation(e){return e.locationName&&""!==e.locationName.trim()&&"0"!==e.locationName.trim()?e.locationName:"Keine Angabe"}},created(){this.fetchTrees()}};var w=Object.assign(f,{setup(e){const t=(0,i.rd)(),r=()=>{const e=localStorage.getItem("token");e||t.push("/")};return(0,o.sV)((()=>{r()})),(e,t)=>((0,o.uX)(),(0,o.CE)("div",{onClick:t[17]||(t[17]=(...t)=>e.closeDropdowns&&e.closeDropdowns(...t))},[t[24]||(t[24]=(0,o.Lk)("h1",null,"Meine gemessenen Bäume",-1)),(0,o.Lk)("div",null,[(0,o.Lk)("p",null,"Gesamtanzahl der Bäume: "+(0,n.v_)(e.filteredTrees.length),1),(0,o.Lk)("p",null,"Durchschnittliche Höhe: "+(0,n.v_)(e.averageHeight)+" m",1)]),(0,o.Lk)("div",a,[(0,o.Lk)("table",c,[(0,o.Lk)("thead",null,[(0,o.Lk)("tr",null,[t[21]||(t[21]=(0,o.Lk)("th",null,"Bild",-1)),(0,o.Lk)("th",{onClick:t[0]||(t[0]=(0,s.D$)((t=>e.toggleDropdown("species",t)),["stop"]))},t[18]||(t[18]=[(0,o.eW)(" Baumart "),(0,o.Lk)("span",{class:"dropdown-arrow"},"▼",-1)])),(0,o.Lk)("th",{onClick:t[1]||(t[1]=(0,s.D$)((t=>e.toggleDropdown("location",t)),["stop"]))},t[19]||(t[19]=[(0,o.eW)(" Standort "),(0,o.Lk)("span",{class:"dropdown-arrow"},"▼",-1)])),(0,o.Lk)("th",{onClick:t[2]||(t[2]=(...t)=>e.openNativeDatePicker&&e.openNativeDatePicker(...t))},t[20]||(t[20]=[(0,o.eW)(" Datum "),(0,o.Lk)("img",{src:l,alt:"",class:"calendar-icon"},null,-1)]))])]),(0,o.Lk)("tbody",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filteredTrees,(t=>((0,o.uX)(),(0,o.CE)("tr",{key:t.id},[(0,o.Lk)("td",null,[e.getImageUrl(t)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:e.getImageUrl(t),alt:"Bild von {{ tree.tree_type.name }}",class:"tree-image"},null,8,d)):((0,o.uX)(),(0,o.CE)(o.FK,{key:1},[(0,o.eW)(" Kein Bild vorhanden ")],64))]),(0,o.Lk)("td",null,(0,n.v_)(`${t.tree_type.name} (${t.tree_type.scientific_name})`),1),(0,o.Lk)("td",null,(0,n.v_)(e.getLocation(t)),1),(0,o.Lk)("td",null,(0,n.v_)(e.formatDate(t.created_at)),1)])))),128))])]),(0,o.bo)((0,o.Lk)("input",{type:"date",ref:"dateInput","onUpdate:modelValue":t[3]||(t[3]=t=>e.selectedDate=t),onChange:t[4]||(t[4]=(...t)=>e.updateFilteredTrees&&e.updateFilteredTrees(...t)),style:{visibility:"hidden",position:"absolute"}},null,544),[[s.Jo,e.selectedDate]]),"species"===e.dropdownOpen?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"dropdown-container hover-dropdown",style:(0,n.Tr)(e.dropdownPosition),onClick:t[10]||(t[10]=(0,s.D$)((()=>{}),["stop"]))},[(0,o.Lk)("div",u,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=t=>e.speciesSearch=t),placeholder:"Suchen...",class:"dropdown-search"},null,512),[[s.Jo,e.speciesSearch]]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=t=>e.selectAllSpecies=t),onChange:t[7]||(t[7]=(...t)=>e.toggleSelectAllSpecies&&e.toggleSelectAllSpecies(...t))},null,544),[[s.lH,e.selectAllSpecies]]),t[22]||(t[22]=(0,o.eW)(" Alles auswählen "))]),(0,o.Lk)("div",p,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filteredSpecies,(r=>((0,o.uX)(),(0,o.CE)("div",{key:r},[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=t=>e.selectedSpecies=t),value:r,onChange:t[9]||(t[9]=(...t)=>e.updateFilteredTrees&&e.updateFilteredTrees(...t))},null,40,h),[[s.lH,e.selectedSpecies]]),(0,o.eW)(" "+(0,n.v_)(r),1)])])))),128))])])],4)):(0,o.Q3)("",!0),"location"===e.dropdownOpen?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"dropdown-container hover-dropdown",style:(0,n.Tr)(e.dropdownPosition),onClick:t[16]||(t[16]=(0,s.D$)((()=>{}),["stop"]))},[(0,o.Lk)("div",m,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=t=>e.locationSearch=t),placeholder:"Suchen...",class:"dropdown-search"},null,512),[[s.Jo,e.locationSearch]]),(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=t=>e.selectAllLocations=t),onChange:t[13]||(t[13]=(...t)=>e.toggleSelectAllLocations&&e.toggleSelectAllLocations(...t))},null,544),[[s.lH,e.selectAllLocations]]),t[23]||(t[23]=(0,o.eW)(" Alles auswählen "))]),(0,o.Lk)("div",E,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.filteredLocations,(r=>((0,o.uX)(),(0,o.CE)("div",{key:r},[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[14]||(t[14]=t=>e.selectedLocations=t),value:r,onChange:t[15]||(t[15]=(...t)=>e.updateFilteredTrees&&e.updateFilteredTrees(...t))},null,40,g),[[s.lH,e.selectedLocations]]),(0,o.eW)(" "+(0,n.v_)(r),1)])])))),128))])])],4)):(0,o.Q3)("",!0)])]))}}),k=r(1241);const _=(0,k.A)(w,[["__scopeId","data-v-76311a14"]]);var L=_}}]);
//# sourceMappingURL=218.692b6934.js.map