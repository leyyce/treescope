"use strict";(self["webpackChunkprojekt"]=self["webpackChunkprojekt"]||[]).push([[814],{655:function(e,s,t){var r=t(6955),a=String;e.exports=function(e){if("Symbol"===r(e))throw new TypeError("Cannot convert a Symbol value to a string");return a(e)}},2603:function(e,s,t){var r=t(655);e.exports=function(e,s){return void 0===e?arguments.length<2?"":s:r(e)}},2967:function(e,s,t){var r=t(6706),a=t(34),o=t(7750),i=t(3506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,s=!1,t={};try{e=r(Object.prototype,"__proto__","set"),e(t,[]),s=t instanceof Array}catch(n){}return function(t,r){return o(t),i(r),a(t)?(s?e(t,r):t.__proto__=r,t):t}}():void 0)},3167:function(e,s,t){var r=t(4901),a=t(34),o=t(2967);e.exports=function(e,s,t){var i,n;return o&&r(i=s.constructor)&&i!==t&&a(n=i.prototype)&&n!==t.prototype&&o(e,n),e}},3506:function(e,s,t){var r=t(3925),a=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o("Can't set "+a(e)+" as a prototype")}},3925:function(e,s,t){var r=t(34);e.exports=function(e){return r(e)||null===e}},4979:function(e,s,t){var r=t(6518),a=t(4576),o=t(7751),i=t(6980),n=t(4913).f,l=t(9297),d=t(679),u=t(3167),c=t(2603),h=t(5002),p=t(8574),m=t(3724),g=t(6395),w="DOMException",E=o("Error"),f=o(w),k=function(){d(this,b);var e=arguments.length,s=c(e<1?void 0:arguments[0]),t=c(e<2?void 0:arguments[1],"Error"),r=new f(s,t),a=new E(s);return a.name=w,n(r,"stack",i(1,p(a.stack,1))),u(r,this,k),r},b=k.prototype=f.prototype,C="stack"in new E(w),v="stack"in new f(1,2),L=f&&m&&Object.getOwnPropertyDescriptor(a,w),y=!!L&&!(L.writable&&L.configurable),_=C&&!y&&!v;r({global:!0,constructor:!0,forced:g||_},{DOMException:_?k:f});var N=o(w),S=N.prototype;if(S.constructor!==N)for(var P in g||n(S,"constructor",i(1,N)),h)if(l(h,P)){var A=h[P],D=A.s;l(N,D)||n(N,D,i(6,A.c))}},5002:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8574:function(e,s,t){var r=t(9504),a=Error,o=r("".replace),i=function(e){return String(new a(e).stack)}("zxcasd"),n=/\n\s*at [^:]*:[^\n]*/,l=n.test(i);e.exports=function(e,s){if(l&&"string"==typeof e&&!a.prepareStackTrace)while(s--)e=o(e,n,"");return e}},8814:function(e,s,t){t.r(s),t.d(s,{default:function(){return W}});var r=t(6768),a=t(4232),o=t(5130);const i={class:"user-profile"},n={key:0},l={class:"form-group"},d={class:"form-group"},u={class:"edit-container"},c={class:"form-group"},h={class:"form-group"},p={class:"form-group"},m={class:"form-group",style:{position:"relative"}},g={key:0,class:"suggestions-list"},w=["onMousedown"],E={key:1,class:"error-message"},f={class:"form-group"},k={class:"form-group"},b={class:"form-group"},C={class:"edit-container"},v={key:0,class:"error-message"},L={key:2,class:"modal-overlay"},y={class:"modal-content"},_={class:"form-group"},N={class:"form-group"},S={key:0,class:"password-requirements"},P={class:"form-group"},A={key:1,class:"error-message"},D={key:2,class:"success-message"},R=["disabled"],M={key:3,class:"modal-overlay"},T={class:"modal-content"},I={class:"form-group"},O=["value"],B={class:"form-group"},U={class:"form-group"},z={class:"form-group"},$={key:0,class:"error-message"},V={key:1,class:"success-message"},x=["disabled"],J={key:4,class:"popup-overlay"},Q={class:"popup-content"};function j(e,s,t,j,X,q){return(0,r.uX)(),(0,r.CE)("div",i,[s[54]||(s[54]=(0,r.Lk)("h1",null,"Benutzerdaten",-1)),X.isEditing?((0,r.uX)(),(0,r.CE)("form",{key:1,onSubmit:s[16]||(s[16]=(0,o.D$)(((...e)=>q.updateUser&&q.updateUser(...e)),["prevent"]))},[(0,r.Lk)("div",l,[s[35]||(s[35]=(0,r.Lk)("label",{for:"username"},[(0,r.eW)("Benutzername "),(0,r.Lk)("span",{class:"required"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{id:"username","onUpdate:modelValue":s[2]||(s[2]=e=>X.user.username=e),type:"text",required:"",placeholder:"Benutzername"},null,512),[[o.Jo,X.user.username]])]),(0,r.Lk)("div",d,[s[36]||(s[36]=(0,r.Lk)("label",{for:"email"},"E-Mail",-1)),(0,r.Lk)("div",u,[(0,r.bo)((0,r.Lk)("input",{id:"email","onUpdate:modelValue":s[3]||(s[3]=e=>X.user.email=e),type:"email",placeholder:"E-Mail-Adresse",disabled:""},null,512),[[o.Jo,X.user.email]]),(0,r.Lk)("button",{type:"button",class:"edit-button",onClick:s[4]||(s[4]=(...e)=>q.openChangeEmailModal&&q.openChangeEmailModal(...e))}," E-Mail bearbeiten ")])]),(0,r.Lk)("div",c,[s[37]||(s[37]=(0,r.Lk)("label",{for:"firstName"},"Vorname",-1)),(0,r.bo)((0,r.Lk)("input",{id:"firstName","onUpdate:modelValue":s[5]||(s[5]=e=>X.user.firstName=e),type:"text",placeholder:"Optional"},null,512),[[o.Jo,X.user.firstName]])]),(0,r.Lk)("div",h,[s[38]||(s[38]=(0,r.Lk)("label",{for:"lastName"},"Nachname",-1)),(0,r.bo)((0,r.Lk)("input",{id:"lastName","onUpdate:modelValue":s[6]||(s[6]=e=>X.user.lastName=e),type:"text",placeholder:"Optional"},null,512),[[o.Jo,X.user.lastName]])]),(0,r.Lk)("div",p,[s[39]||(s[39]=(0,r.Lk)("label",{for:"step_length"},[(0,r.eW)("Schrittlänge (in cm) "),(0,r.Lk)("span",{class:"required"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{id:"step_length","onUpdate:modelValue":s[7]||(s[7]=e=>X.user.step_length=e),type:"number",required:"",placeholder:"Schrittlänge in cm"},null,512),[[o.Jo,X.user.step_length,void 0,{number:!0}]])]),(0,r.Lk)("div",m,[s[40]||(s[40]=(0,r.Lk)("label",{for:"address"},[(0,r.eW)("Adresse "),(0,r.Lk)("span",{class:"required"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{id:"address","onUpdate:modelValue":s[8]||(s[8]=e=>X.addressQuery=e),type:"text",placeholder:"Adresse eingeben",onInput:s[9]||(s[9]=(...e)=>q.onAddressInput&&q.onAddressInput(...e)),onBlur:s[10]||(s[10]=(...e)=>q.hideSuggestions&&q.hideSuggestions(...e)),autocomplete:"off",required:""},null,544),[[o.Jo,X.addressQuery]]),X.addressSuggestions.length>0?((0,r.uX)(),(0,r.CE)("ul",g,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(X.addressSuggestions,((e,s)=>((0,r.uX)(),(0,r.CE)("li",{key:s,onMousedown:(0,o.D$)((s=>q.selectAddress(e)),["prevent"])},(0,a.v_)(e.display),41,w)))),128))])):(0,r.Q3)("",!0),X.addressError?((0,r.uX)(),(0,r.CE)("div",E,(0,a.v_)(X.addressError),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",f,[s[41]||(s[41]=(0,r.Lk)("label",{for:"latitude"},"Breitengrad (Latitude)",-1)),(0,r.bo)((0,r.Lk)("input",{id:"latitude","onUpdate:modelValue":s[11]||(s[11]=e=>X.user.latitude=e),type:"text",placeholder:"Latitude",readonly:"",required:"",disabled:""},null,512),[[o.Jo,X.user.latitude]])]),(0,r.Lk)("div",k,[s[42]||(s[42]=(0,r.Lk)("label",{for:"longitude"},"Längengrad (Longitude)",-1)),(0,r.bo)((0,r.Lk)("input",{id:"longitude","onUpdate:modelValue":s[12]||(s[12]=e=>X.user.longitude=e),type:"text",placeholder:"Longitude",readonly:"",required:"",disabled:""},null,512),[[o.Jo,X.user.longitude]])]),(0,r.Lk)("div",b,[s[43]||(s[43]=(0,r.Lk)("label",null,"Passwort",-1)),(0,r.Lk)("div",C,[(0,r.bo)((0,r.Lk)("input",{type:"password","onUpdate:modelValue":s[13]||(s[13]=e=>X.user.password=e),id:"password",placeholder:"********",disabled:""},null,512),[[o.Jo,X.user.password]]),(0,r.Lk)("button",{type:"button",class:"edit-button",onClick:s[14]||(s[14]=(...e)=>q.openChangePasswordModal&&q.openChangePasswordModal(...e))}," Passwort ändern ")])]),X.formError?((0,r.uX)(),(0,r.CE)("div",v,(0,a.v_)(X.formError),1)):(0,r.Q3)("",!0),s[44]||(s[44]=(0,r.Lk)("button",{type:"submit",class:"save-button"},"Speichern",-1)),(0,r.Lk)("button",{type:"button",onClick:s[15]||(s[15]=(...e)=>q.toggleEdit&&q.toggleEdit(...e)),class:"cancel-button"},"Abbrechen")],32)):((0,r.uX)(),(0,r.CE)("div",n,[(0,r.Lk)("button",{onClick:s[0]||(s[0]=(...e)=>q.toggleEdit&&q.toggleEdit(...e)),class:"userdata-edit-button"}," Benutzerdaten bearbeiten "),(0,r.Lk)("p",null,[s[28]||(s[28]=(0,r.Lk)("strong",null,"Benutzername:",-1)),(0,r.eW)(" "+(0,a.v_)(X.user.username||"Nicht angegeben"),1)]),(0,r.Lk)("p",null,[s[29]||(s[29]=(0,r.Lk)("strong",null,"E-Mail:",-1)),(0,r.eW)(" "+(0,a.v_)(X.user.email||"Nicht angegeben"),1)]),(0,r.Lk)("p",null,[s[30]||(s[30]=(0,r.Lk)("strong",null,"Vorname:",-1)),(0,r.eW)(" "+(0,a.v_)(X.user.firstName||"Nicht angegeben"),1)]),(0,r.Lk)("p",null,[s[31]||(s[31]=(0,r.Lk)("strong",null,"Nachname:",-1)),(0,r.eW)(" "+(0,a.v_)(X.user.lastName||"Nicht angegeben"),1)]),(0,r.Lk)("p",null,[s[32]||(s[32]=(0,r.Lk)("strong",null,"Schrittlänge (in cm):",-1)),(0,r.eW)(" "+(0,a.v_)(X.user.step_length||"Nicht angegeben"),1)]),(0,r.Lk)("p",null,[s[33]||(s[33]=(0,r.Lk)("strong",null,"Adresse:",-1)),(0,r.eW)(" "+(0,a.v_)(X.user.address||"Nicht angegeben"),1)]),s[34]||(s[34]=(0,r.Lk)("p",null,[(0,r.Lk)("strong",null,"Passwort:"),(0,r.eW)(" ********")],-1)),(0,r.Lk)("button",{type:"button",class:"delete-button",onClick:s[1]||(s[1]=(...e)=>q.deleteAccount&&q.deleteAccount(...e))}," Account löschen ")])),X.showPasswordModal?((0,r.uX)(),(0,r.CE)("div",L,[(0,r.Lk)("div",y,[s[48]||(s[48]=(0,r.Lk)("h2",null,"Passwort ändern",-1)),(0,r.Lk)("form",{onSubmit:s[21]||(s[21]=(0,o.D$)(((...e)=>q.changePassword&&q.changePassword(...e)),["prevent"]))},[(0,r.Lk)("div",_,[s[45]||(s[45]=(0,r.Lk)("label",{for:"oldPassword"},"Altes Passwort",-1)),(0,r.bo)((0,r.Lk)("input",{id:"oldPassword","onUpdate:modelValue":s[17]||(s[17]=e=>X.passwordData.oldPassword=e),type:"password",required:""},null,512),[[o.Jo,X.passwordData.oldPassword]])]),(0,r.Lk)("div",N,[s[46]||(s[46]=(0,r.Lk)("label",{for:"newPassword"},"Neues Passwort",-1)),(0,r.bo)((0,r.Lk)("input",{id:"newPassword","onUpdate:modelValue":s[18]||(s[18]=e=>X.passwordData.newPassword=e),type:"password",required:""},null,512),[[o.Jo,X.passwordData.newPassword]])]),X.passwordData.newPassword?((0,r.uX)(),(0,r.CE)("div",S,[(0,r.Lk)("p",{class:(0,a.C4)({valid:q.passwordChecks.length})},"Mindestens 8 Zeichen",2),(0,r.Lk)("p",{class:(0,a.C4)({valid:q.passwordChecks.hasUpper})},"Mindestens ein Großbuchstabe",2),(0,r.Lk)("p",{class:(0,a.C4)({valid:q.passwordChecks.hasLower})},"Mindestens ein Kleinbuchstabe",2),(0,r.Lk)("p",{class:(0,a.C4)({valid:q.passwordChecks.hasNumber})},"Mindestens eine Zahl",2),(0,r.Lk)("p",{class:(0,a.C4)({valid:q.passwordChecks.hasSpecial})},"Mindestens ein Sonderzeichen",2)])):(0,r.Q3)("",!0),(0,r.Lk)("div",P,[s[47]||(s[47]=(0,r.Lk)("label",{for:"confirmNewPassword"},"Neues Passwort bestätigen",-1)),(0,r.bo)((0,r.Lk)("input",{id:"confirmNewPassword","onUpdate:modelValue":s[19]||(s[19]=e=>X.passwordData.confirmNewPassword=e),type:"password",required:""},null,512),[[o.Jo,X.passwordData.confirmNewPassword]])]),X.passwordChangeError?((0,r.uX)(),(0,r.CE)("div",A,(0,a.v_)(X.passwordChangeError),1)):(0,r.Q3)("",!0),X.passwordChangeSuccess?((0,r.uX)(),(0,r.CE)("div",D,(0,a.v_)(X.passwordChangeSuccess),1)):(0,r.Q3)("",!0),(0,r.Lk)("button",{type:"submit",disabled:!q.isPasswordValid,class:"save-button"},"Änderungen speichern",8,R),(0,r.Lk)("button",{type:"button",onClick:s[20]||(s[20]=(...e)=>q.closeChangePasswordModal&&q.closeChangePasswordModal(...e)),class:"cancel-button"},"Abbrechen")],32)])])):(0,r.Q3)("",!0),X.showEmailModal?((0,r.uX)(),(0,r.CE)("div",M,[(0,r.Lk)("div",T,[s[53]||(s[53]=(0,r.Lk)("h2",null,"E-Mail ändern",-1)),(0,r.Lk)("form",{onSubmit:s[26]||(s[26]=(0,o.D$)(((...e)=>q.changeEmail&&q.changeEmail(...e)),["prevent"]))},[(0,r.Lk)("div",I,[s[49]||(s[49]=(0,r.Lk)("label",{for:"currentEmail"},"Aktuelle E-Mail",-1)),(0,r.Lk)("input",{id:"currentEmail",type:"email",value:X.user.email,disabled:""},null,8,O)]),(0,r.Lk)("div",B,[s[50]||(s[50]=(0,r.Lk)("label",{for:"newEmail"},"Neue E-Mail",-1)),(0,r.bo)((0,r.Lk)("input",{id:"newEmail","onUpdate:modelValue":s[22]||(s[22]=e=>X.emailData.newEmail=e),type:"email",required:"",placeholder:"Neue E-Mail-Adresse"},null,512),[[o.Jo,X.emailData.newEmail]])]),(0,r.Lk)("div",U,[s[51]||(s[51]=(0,r.Lk)("label",{for:"confirmNewEmail"},"Neue E-Mail bestätigen",-1)),(0,r.bo)((0,r.Lk)("input",{id:"confirmNewEmail","onUpdate:modelValue":s[23]||(s[23]=e=>X.emailData.confirmNewEmail=e),type:"email",required:"",placeholder:"Neue E-Mail-Adresse bestätigen"},null,512),[[o.Jo,X.emailData.confirmNewEmail]])]),(0,r.Lk)("div",z,[s[52]||(s[52]=(0,r.Lk)("label",{for:"currentPassword"},"Aktuelles Passwort",-1)),(0,r.bo)((0,r.Lk)("input",{id:"currentPassword","onUpdate:modelValue":s[24]||(s[24]=e=>X.emailData.currentPassword=e),type:"password",required:"",placeholder:"Aktuelles Passwort"},null,512),[[o.Jo,X.emailData.currentPassword]])]),X.emailChangeError?((0,r.uX)(),(0,r.CE)("div",$,(0,a.v_)(X.emailChangeError),1)):(0,r.Q3)("",!0),X.emailChangeSuccess?((0,r.uX)(),(0,r.CE)("div",V,(0,a.v_)(X.emailChangeSuccess),1)):(0,r.Q3)("",!0),(0,r.Lk)("button",{type:"submit",disabled:!q.isEmailValid,class:"save-button"},"Änderungen speichern",8,x),(0,r.Lk)("button",{type:"button",onClick:s[25]||(s[25]=(...e)=>q.closeChangeEmailModal&&q.closeChangeEmailModal(...e)),class:"cancel-button"},"Abbrechen")],32)])])):(0,r.Q3)("",!0),X.showPopup?((0,r.uX)(),(0,r.CE)("div",J,[(0,r.Lk)("div",Q,[(0,r.Lk)("p",null,(0,a.v_)(X.popupMessage),1),(0,r.Lk)("button",{onClick:s[27]||(s[27]=(...e)=>q.closePopup&&q.closePopup(...e))},"OK")])])):(0,r.Q3)("",!0)])}t(4114),t(8111),t(1701),t(4979);var X={data(){return{isEditing:!1,showPasswordModal:!1,showEmailModal:!1,showPopup:!1,popupMessage:"",user:{username:"",email:"",firstName:"",lastName:"",step_length:0,address:"",latitude:"",longitude:"",password:""},passwordData:{oldPassword:"",newPassword:"",confirmNewPassword:""},emailData:{newEmail:"",confirmNewEmail:"",currentPassword:""},emailChangeError:"",emailChangeSuccess:"",passwordChangeError:"",passwordChangeSuccess:"",addressQuery:"",addressSuggestions:[],addressSearchTimeout:null,addressError:"",formError:""}},computed:{passwordChecks(){const e=this.passwordData.newPassword;return{length:e.length>=8,hasUpper:/[A-Z]/.test(e),hasLower:/[a-z]/.test(e),hasNumber:/[0-9]/.test(e),hasSpecial:/[^A-Za-z0-9]/.test(e)}},isPasswordValid(){const e=this.passwordChecks;return e.length&&e.hasUpper&&e.hasLower&&e.hasNumber&&e.hasSpecial&&this.passwordData.newPassword===this.passwordData.confirmNewPassword},isEmailValid(){return this.emailData.newEmail===this.emailData.confirmNewEmail&&this.emailData.newEmail.includes("@")&&""!==this.emailData.currentPassword.trim()},isAddressValid(){return""!==this.user.address.trim()&&""!==this.user.latitude.trim()&&""!==this.user.longitude.trim()}},methods:{toggleEdit(){this.isEditing=!this.isEditing,this.isEditing||this.fetchUserData()},formatCoordinate(e){const s=parseFloat(e);return isNaN(s)?"":s.toFixed(6)},validateCoordinates(){const e=parseFloat(this.user.latitude),s=parseFloat(this.user.longitude);return isNaN(e)||e<-90||e>90?(this.formError="Bitte gib einen gültigen Breitengrad ein.",!1):!(isNaN(s)||s<-180||s>180)||(this.formError="Bitte gib einen gültigen Längengrad ein.",!1)},async fetchUserData(){const e=localStorage.getItem("token");if(!e)return alert("Kein Authentifizierungstoken gefunden. Bitte logge dich erneut ein."),void this.$router.push("/login");try{const s=JSON.parse(atob(e.split(".")[1])),t=s.user_id||s.id;if(!t)return alert("Benutzer-ID konnte nicht ermittelt werden."),void this.$router.push("/login");const r=await fetch(`https://treescope.cs.hs-fulda.de/api/v1/users/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(r.ok){const e=await r.json();this.user.username=e.username||"",this.user.email=e.email||"",this.user.firstName=e.first_name||"",this.user.lastName=e.last_name||"",this.user.step_length=e.step_length||0,this.user.latitude=this.formatCoordinate(e.latitude)||"",this.user.longitude=this.formatCoordinate(e.longitude)||"",this.user.latitude&&this.user.longitude&&await this.reverseGeocode(this.user.latitude,this.user.longitude)}else alert("Fehler beim Abrufen deiner Benutzerdaten. Bitte versuche es später erneut.")}catch(s){alert("Netzwerkfehler oder Server nicht erreichbar")}},async updateUser(){const e=localStorage.getItem("token");if(!e)return alert("Kein Authentifizierungstoken gefunden. Bitte logge dich erneut ein."),void this.$router.push("/login");if(this.formError="",this.addressError="",this.isAddressValid){if(this.validateCoordinates())if(this.user.username.trim())if(!this.user.step_length||this.user.step_length<60||this.user.step_length>90)this.formError="Bitte gib eine Schrittlänge zwischen 60 und 90 cm ein.";else try{const s=JSON.parse(atob(e.split(".")[1])),t=s.user_id||s.id;if(!t)return alert("Benutzer-ID konnte nicht ermittelt werden."),void this.$router.push("/login");const r={username:this.user.username,latitude:this.formatCoordinate(this.user.latitude),longitude:this.formatCoordinate(this.user.longitude),step_length:this.user.step_length};""!==this.user.firstName.trim()&&(r.first_name=this.user.firstName),""!==this.user.lastName.trim()&&(r.last_name=this.user.lastName);const a=await fetch(`https://treescope.cs.hs-fulda.de/api/v1/users/${t}`,{method:"PATCH",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(a.ok){const e=await a.json();alert("Daten erfolgreich aktualisiert!"),this.isEditing=!1,this.user.username=e.username||"",this.user.email=e.email||"",this.user.firstName=e.first_name||"",this.user.lastName=e.last_name||"",this.user.step_length=e.step_length||0,this.user.latitude=this.formatCoordinate(e.latitude)||"",this.user.longitude=this.formatCoordinate(e.longitude)||"",localStorage.setItem("step_size",this.user.step_length),this.user.latitude&&this.user.longitude&&await this.reverseGeocode(this.user.latitude,this.user.longitude)}else{const e=await a.json()||{},s=e.message||"";s.includes("first_name")?this.formError="Der Vorname darf keine Zahlen oder Sonderzeichen enthalten.":s.includes("last_name")?this.formError="Der Nachname darf keine Zahlen oder Sonderzeichen enthalten.":this.formError="Beim Speichern ist ein Fehler aufgetreten. Bitte prüfe deine Eingaben."}}catch(s){this.formError="Netzwerkfehler oder Server nicht erreichbar."}else this.formError="Bitte gib einen gültigen Benutzernamen ein."}else this.formError="Bitte wähle eine gültige Adresse aus."},async changeEmail(){const e=localStorage.getItem("token");if(!e)return alert("Kein Authentifizierungstoken gefunden. Bitte logge dich erneut ein."),void this.$router.push("/login");if(this.emailData.newEmail!==this.emailData.confirmNewEmail)return this.emailChangeError="Die neuen E-Mail-Adressen stimmen nicht überein!",void(this.emailChangeSuccess="");if(""===this.emailData.currentPassword.trim())return this.emailChangeError="Bitte gib dein aktuelles Passwort ein.",void(this.emailChangeSuccess="");try{const s={email:this.emailData.newEmail,password:this.emailData.currentPassword},t=await fetch("https://treescope.cs.hs-fulda.de/auth/change-mail",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(s)}),r=await t.json();t.ok?(this.popupMessage=r.message||"E-Mail erfolgreich geändert!",this.showPopup=!0,this.emailChangeSuccess=r.message||"E-Mail erfolgreich geändert!",this.emailChangeError="",this.user.email=r.email||this.emailData.newEmail,this.emailData={newEmail:"",confirmNewEmail:"",currentPassword:""}):(this.emailChangeError="Es gab einen Fehler beim Ändern der E-Mail. Bitte prüfe deine Eingaben.",this.emailChangeSuccess="")}catch(s){this.emailChangeError="Netzwerkfehler oder Server nicht erreichbar.",this.emailChangeSuccess=""}},async changePassword(){const e=localStorage.getItem("token");if(!e)return alert("Kein Authentifizierungstoken gefunden. Bitte logge dich erneut ein."),void this.$router.push("/login");if(!this.isPasswordValid)return this.passwordChangeError="Bitte erfülle alle Passwortanforderungen.",void(this.passwordChangeSuccess="");if(this.passwordData.newPassword!==this.passwordData.confirmNewPassword)return this.passwordChangeError="Die neuen Passwörter stimmen nicht überein!",void(this.passwordChangeSuccess="");try{const s={old_password:this.passwordData.oldPassword,new_password:this.passwordData.newPassword},t=await fetch("https://treescope.cs.hs-fulda.de/auth/change-password",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(s)}),r=await t.json();t.ok?(this.popupMessage=r.message||"Passwort erfolgreich geändert!",this.showPopup=!0,this.passwordChangeSuccess=r.message||"Passwort erfolgreich geändert!",this.passwordChangeError="",this.passwordData={oldPassword:"",newPassword:"",confirmNewPassword:""},this.closeChangePasswordModal()):(this.passwordChangeError="Fehler beim Ändern des Passworts. Bitte prüfe deine Eingaben.",this.passwordChangeSuccess="")}catch(s){this.passwordChangeError="Netzwerkfehler oder Server nicht erreichbar.",this.passwordChangeSuccess=""}},async deleteAccount(){const e=confirm("Möchten Sie den Account wirklich löschen?");if(!e)return;const s=localStorage.getItem("token");if(!s)return alert("Kein Authentifizierungstoken gefunden. Bitte logge dich erneut ein."),void this.$router.push("/login");try{const e=JSON.parse(atob(s.split(".")[1])),t=e.user_id||e.id;if(!t)return alert("Benutzer-ID konnte nicht ermittelt werden."),void this.$router.push("/login");const r=await fetch(`https://treescope.cs.hs-fulda.de/api/v1/users/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(r.ok){const e=await r.json();alert(e.message||"Der Account wurde gelöscht!"),localStorage.removeItem("token"),window.location.href="/"}else alert("Fehler beim Löschen des Accounts. Bitte versuche es erneut.")}catch(t){alert("Netzwerkfehler oder Server nicht erreichbar.")}},closePopup(){this.showPopup=!1,this.emailChangeSuccess&&this.closeChangeEmailModal(),this.passwordChangeSuccess&&this.closeChangePasswordModal()},onAddressInput(){this.addressSearchTimeout&&clearTimeout(this.addressSearchTimeout),this.addressSearchTimeout=setTimeout((()=>{this.fetchAddressSuggestions()}),500)},async fetchAddressSuggestions(){if(""!==this.addressQuery.trim())try{const e=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(this.addressQuery)}&addressdetails=1&limit=5`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();this.addressSuggestions=s.map((e=>{const s=e.address||{},t=s.postcode||"",r=s.city||s.town||s.village||"",a=s.country||"",o=`${t} ${r}, ${a}`;return{display:o,lat:this.formatCoordinate(e.lat),lon:this.formatCoordinate(e.lon)}}))}catch(e){console.error("Fehler bei der Adresssuche:",e)}else this.addressSuggestions=[]},async selectAddress(e){this.user.address=e.display,this.user.latitude=this.formatCoordinate(e.lat),this.user.longitude=this.formatCoordinate(e.lon),this.addressQuery=e.display,this.addressSuggestions=[],this.addressError=""},hideSuggestions(){setTimeout((()=>{this.addressSuggestions=[]}),200)},async reverseGeocode(e,s){try{const t=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${s}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json(),a=r.address||{},o=a.postcode||"",i=a.city||a.town||a.village||"",n=a.country||"";this.user.address=`${o} ${i}, ${n}`,this.addressQuery=`${o} ${i}, ${n}`}catch(t){console.error("Fehler bei der Reverse-Geokodierung:",t)}},openChangePasswordModal(){this.showPasswordModal=!0,this.passwordChangeError="",this.passwordChangeSuccess=""},closeChangePasswordModal(){this.showPasswordModal=!1,this.passwordData={oldPassword:"",newPassword:"",confirmNewPassword:""},this.passwordChangeError="",this.passwordChangeSuccess=""},openChangeEmailModal(){this.showEmailModal=!0,this.emailChangeError="",this.emailChangeSuccess=""},closeChangeEmailModal(){this.showEmailModal=!1,this.emailData={newEmail:"",confirmNewEmail:"",currentPassword:""},this.emailChangeError="",this.emailChangeSuccess=""}},mounted(){this.fetchUserData()}},q=t(1241);const F=(0,q.A)(X,[["render",j],["__scopeId","data-v-25254609"]]);var W=F}}]);
//# sourceMappingURL=814.4e76554d.js.map